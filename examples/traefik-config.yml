# Example Traefik Configuration with Geo Access Control

# Static Configuration (traefik.yml)
experimental:
  localPlugins:
    geo-access-control:
      moduleName: github.com/hululu75/geo-access-control

# Dynamic Configuration (config.yml)
http:
  middlewares:
    # Example 1: Basic allow/deny
    geo-simple:
      plugin:
        geo-access-control:
          geoAPIEndpoint: "http://geoip-api:8080/country/{ip}"
          accessRules:
            US: true  # Allow US
            CA: true  # Allow Canada
            KP: false # Deny North Korea

    # Example 2: IP-based rules
    ip-rules:
      plugin:
        geo-access-control:
          geoAPIEndpoint: "http://geoip-api:8080/country/{ip}"
          accessRules:
            "1.1.1.1": false # Deny a specific IP
            "8.8.0.0/16": true # Allow a CIDR range

    # Example 3: Complex hierarchical rules
    geo-complex:
      plugin:
        geo-access-control:
          geoAPIEndpoint: "http://geoip-api:8080/country/{ip}"
          accessRules:
            # IP rules take precedence
            "10.0.0.0/8": false

            # Geo Rules
            US: true # Allow all of US
            GB:
              regions:
                SCO: false # Deny Scotland
                ENG:
                  cities:
                    - London # Allow London
            CN:
              regions:
                HK: false # Deny Hong Kong

    # Example 4: Full configuration
    geo-full:
      plugin:
        geo-access-control:
          geoAPIEndpoint: "http://geoip-api:8080/country/{ip}"
          geoAPITimeout: 1000
          geoAPIResponseIsJSON: true
          accessRules:
            "1.2.3.4": true
            US: true
            KP: false
          allowPrivateIPAccess: true
          allowRequestsWithoutGeoData: false
          deniedStatusCode: 403
          deniedResponseMessage: "Access Denied"
          redirectURL: ""
          cacheSize: 100
          excludedPaths: ["/health", "/metrics"]
          logAllowedAccess: false
          logDeniedAccess: true
          logGeoAPICalls: false
          logPrivateIPAccess: false
          logWhiteListAccess: false
          logLevel: "info"
          logFilePath: "/var/log/traefik/geo-access.log"

  routers:
    my-app:
      rule: "Host(`myapp.example.com`)"
      service: my-app-service
      middlewares:
        - geo-complex

  services:
    my-app-service:
      loadBalancer:
        servers:
          - url: "http://localhost:8000"