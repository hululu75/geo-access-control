# Example Traefik Configuration with Geo Access Control

# Static Configuration (traefik.yml)
experimental:
  localPlugins:
    geo-access-control:
      moduleName: github.com/hululu75/geo-access-control

# Dynamic Configuration (config.yml)
http:
  middlewares:
    # Example 1: Basic allow/deny
    geo-simple:
      plugin:
        geo-access-control:
          api: "http://geoip-api:8080/country/{ip}"
          allowedLists:
            US: true  # Allow US
            CA: true  # Allow Canada
            KP: false # Deny North Korea

    # Example 2: IP-based rules
    ip-rules:
      plugin:
        geo-access-control:
          api: "http://geoip-api:8080/country/{ip}"
          allowedLists:
            "1.1.1.1": false # Deny a specific IP
            "8.8.0.0/16": true # Allow a CIDR range

    # Example 3: Complex hierarchical rules
    geo-complex:
      plugin:
        geo-access-control:
          api: "http://geoip-api:8080/country/{ip}"
          allowedLists:
            # IP rules take precedence
            "10.0.0.0/8": false

            # Geo Rules
            US: true # Allow all of US
            GB:
              regions:
                SCO: false # Deny Scotland
                ENG:
                  cities:
                    - London # Allow London
            CN:
              regions:
                HK: false # Deny Hong Kong

    # Example 4: Full configuration
    geo-full:
      plugin:
        geo-access-control:
          api: "http://geoip-api:8080/country/{ip}"
          apiTimeoutMs: 1000
          allowedLists:
            "1.2.3.4": true
            US: true
            KP: false
          allowLocalRequests: true
          allowUnknownCountries: false
          deniedHTTPStatusCode: 403
          # ... other options

  routers:
    my-app:
      rule: "Host(`myapp.example.com`)"
      service: my-app-service
      middlewares:
        - geo-complex

  services:
    my-app-service:
      loadBalancer:
        servers:
          - url: "http://localhost:8000"